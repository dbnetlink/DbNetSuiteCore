"use strict";class DbNetCombo extends DbNetSuite{constructor(n){super(n);this.addEmptyOption=!1;this.addFilter=!1;this.autoRowSelect=!1;this.currentValue="";this.dataOnlyColumns=[];this.emptyOptionText="";this.fromPart="";this.filterDelay=1e3;this.filterMinChars=3;this.filterToken="";this.foreignKeyColumn="";this.linkedControls=[];this.multipleSelect=!1;this.params={};this.size=1;this.textColumn="";this.valueColumn=""}initialize(){this.callServer("page");this.initialised=!0;this.fireEvent("onInitialized")}addLinkedControl(n){this.linkedControls.push(n)}reload(){this.callServer("page")}selectedValues(){return this.getSelectedValues()}selectedOptions(){return this.getSelectedOptions()}configureCombo(n){var t,i,r,u,f,e,o,s,h,c;if(n.select){(t=this.element)===null||t===void 0?void 0:t.html(n.select);this.$select=(i=this.element)===null||i===void 0?void 0:i.find("select");(r=this.$select)===null||r===void 0?void 0:r.html(n.options);const s=(u=this.$select)===null||u===void 0?void 0:u.width();this.$filter=(f=this.element)===null||f===void 0?void 0:f.find("input");(e=this.$filter)===null||e===void 0?void 0:e.width(s);(o=this.$filter)===null||o===void 0?void 0:o.on("keyup",n=>this.filterKeyPress(n));this.$select.on("change",()=>this.optionSelected())}else(s=this.$select)===null||s===void 0?void 0:s.html(n.options);this.autoRowSelect&&this.size>1&&((h=this.$select)===null||h===void 0?void 0:h.children().length)>0&&((c=this.$select)===null||c===void 0?void 0:c.prop("selectedIndex",0));this.fireEvent("onOptionsLoaded");this.optionSelected()}optionSelected(){const n=this.getSelectedValues(),t=this.getSelectedOptions();this.fireEvent("onOptionSelected",{selectedValues:n,selectedOptions:t});this.linkedControls.forEach(t=>{if(t instanceof DbNetGrid){const i=t;i.configureLinkedGrid(i,n)}if(t instanceof DbNetCombo){const i=t;i.configureLinkedCombo(i,n)}})}getSelectedValues(){var n;const t=[];return(n=this.$select)===null||n===void 0?void 0:n.find("option:selected").each(function(){const n=$(this).val();n.length>0&&t.push(n)}),t}getSelectedOptions(){var n;const t=[];return(n=this.$select)===null||n===void 0?void 0:n.find("option:selected").each(function(){t.push($(this)[0])}),t}configureLinkedCombo(n,t){n.connectionString==""&&(n.connectionString=this.connectionString);n.foreignKeyValue=t;n.initialised?n.reload():n.initialize()}filterKeyPress(n){const t=n.target;window.clearTimeout(this.filterTimerId);(t.value.length>=this.filterMinChars||t.value.length==0||n.key=="Enter")&&(this.filterTimerId=window.setTimeout(()=>{this.applyFilter(t.value)},this.filterDelay))}applyFilter(n){this.filterToken=n;this.callServer("filter")}callServer(n){this.post(n,this.getRequest()).then(n=>{n.error==!1&&this.configureCombo(n)})}getRequest(){return{componentId:this.id,connectionString:this.connectionString,dataOnlyColumns:this.dataOnlyColumns,fromPart:this.fromPart,valueColumn:this.valueColumn,textColumn:this.textColumn,params:this.params,addEmptyOption:this.addEmptyOption,emptyOptionText:this.emptyOptionText,addFilter:this.addFilter,filterToken:this.filterToken,foreignKeyColumn:this.foreignKeyColumn,foreignKeyValue:this.foreignKeyValue,size:this.size,multipleSelect:this.multipleSelect}}post(n,t){this.showLoader();const i={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(t)};return fetch(`~/dbnetcombo.dbnetsuite?action=${n}`,i).then(n=>{if(this.hideLoader(),!n.ok)throw n;return n.json()}).catch(n=>(n.text().then(n=>{console.error(n),this.error(n.split("\n").shift())}),Promise.reject()))}}