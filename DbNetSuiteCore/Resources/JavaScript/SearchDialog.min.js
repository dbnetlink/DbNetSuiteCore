"use strict";class SearchDialog extends Dialog{constructor(n,t){var i,r,u,f,e,o,s,h,c;super(n);this.inputBuffer={};(i=this.$dialog)===null||i===void 0?void 0:i.on("dialogopen",n=>this.dialogOpened(n));this.parent=t;(r=this.$dialog)===null||r===void 0?void 0:r.find("select.search-operator").on("change",n=>this.configureForOperator(n));(u=this.$dialog)===null||u===void 0?void 0:u.find("[button-type='calendar']").on("click",n=>this.selectDate(n));(f=this.$dialog)===null||f===void 0?void 0:f.find("[button-type='lookup']").on("click",n=>this.lookup(n));(e=this.$dialog)===null||e===void 0?void 0:e.find("input").get().forEach(n=>{const t=$(n);t.width(300);t.on("keyup",n=>this.criteriaEntered(n.target));if(t.attr("numeric"))t.on("keypress",n=>this.filterNumericKeyPress(n))});(o=this.$dialog)===null||o===void 0?void 0:o.find("input[datatype='DateTime']").get().forEach(n=>{const t=$(n);this.addDatePicker(t,this.parent.datePickerOptions)});(s=this.$dialog)===null||s===void 0?void 0:s.find("[button-type='clear']").on("click",()=>this.clear());(h=this.$dialog)===null||h===void 0?void 0:h.find("[button-type='apply']").on("click",()=>this.apply());(c=this.$dialog)===null||c===void 0?void 0:c.find("[button-type='cancel']").on("click",()=>this.close())}dialogOpened(){var n,t;const i=((n=this.$dialog)===null||n===void 0?void 0:n.find("table").first().width())+20;(t=this.$dialog)===null||t===void 0?void 0:t.dialog("option","width",i)}configureForOperator(n){const i=$(n.target);if(i.attr("dataType")!="Boolean"){const t=i.closest("tr");switch(i.val()){case"Between":case"NotBetween":t.find(".between").show();t.find("input").show().width(102);break;case"IsNull":case"IsNotNull":t.find(".between").hide();t.find("input").hide();break;default:t.find(".between").hide();t.find("input").show().width(300)}}}filterNumericKeyPress(n){const t=String.fromCharCode(n.which);if(!t.match(/[0-9,.]/)){window.clearTimeout(this.timerId);const i=$(n.currentTarget).attr("columnIndex");return this.timerId=window.setTimeout(()=>{this.checkInputBuffer(i)},500),this.inputBuffer[i]==null?this.inputBuffer[i]=t:this.inputBuffer[i]+=t,!1}}checkInputBuffer(n){var i;if(this.inputBuffer[n]!=null){let t=null;switch(this.inputBuffer[n]){case">":t="GreaterThan";break;case"<":t="LessThan";break;case"<=":t="NotGreaterThan";break;case">=":t="NotLessThan";break;case"<>":case"!=":t="NotEqualTo"}if(t){const r=(i=this.$dialog)===null||i===void 0?void 0:i.find(`[name='searchOperator(${n})']`);r.val(t)}this.inputBuffer={}}}criteriaEntered(n){const t=$(n);t.removeClass("highlight");const r=t.closest("tr").parent().closest("tr"),i=r.find("select");t.val()==""?i.val(""):i.val()==""&&i.prop("selectedIndex",1)}selectDate(n){const t=$(n.target);t.parent().find("input").datepicker("show")}lookup(n){const i=$(n.target),r=i.parent().find("input");let t;if(this.parent instanceof DbNetGrid)t=this.parent.getRequest();else if(this.parent instanceof DbNetEdit)t=this.parent.getRequest();else return;this.parent.lookup(r,t)}selectTime(n){const t=$(n.target);t.parent().find("input").timepicker("open");n.stopPropagation()}clear(){var n,t;(n=this.$dialog)===null||n===void 0?void 0:n.find(".content").find("input").get().forEach(n=>{const t=$(n);t.val("");t.removeClass("highlight")});(t=this.$dialog)===null||t===void 0?void 0:t.find(".content").find("select").get().forEach(n=>{const t=$(n);t.val("")})}apply(){var n,t,i;if(this.parent.searchParams=[],(n=this.$dialog)===null||n===void 0?void 0:n.find(".content").find("select").get().forEach(n=>{const i=$(n),r=i.closest("tr"),t=r.find("input:eq(0)"),u=r.find("input:eq(1)");if(i.val()!=""&&(t.is(":visible")==!1||t.val()!="")){const n={searchOperator:i.val(),columnIndex:t.attr("columnIndex"),value1:t.val(),value2:u.val()};this.parent.searchParams.push(n)}}),this.parent instanceof DbNetGrid){const n=this.parent;n.clearColumnFilters();n.searchFilterJoin=(t=this.$dialog)===null||t===void 0?void 0:t.find("#searchFilterJoin").val();n.currentPage=1;n.getPage(n=>this.getPageCallback(n))}else{const n=this.parent;n.searchFilterJoin=(i=this.$dialog)===null||i===void 0?void 0:i.find("#searchFilterJoin").val();n.currentRow=1;n.getRows(n=>this.getPageCallback(n))}}getPageCallback(n){n.searchParams&&(n.searchParams.forEach(n=>{var i;const t=(i=this.$dialog)===null||i===void 0?void 0:i.find(`tr[columnIndex='${n.columnIndex}']`),r=t===null||t===void 0?void 0:t.find("input:nth-of-type(1)"),u=t===null||t===void 0?void 0:t.find("input:nth-of-type(2)");n.value1Valid==!1&&(r===null||r===void 0?void 0:r.addClass("highlight"));n.value2Valid==!1&&(u===null||u===void 0?void 0:u.addClass("highlight"))}),n.message&&this.message(n.message))}}