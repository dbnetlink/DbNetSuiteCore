"use strict";class SearchDialog extends Dialog{constructor(n,t){var i,r,u,f,e,o,s,h,c,l,a;super(n);(i=this.$dialog)===null||i===void 0?void 0:i.on("dialogopen",n=>this.dialogOpened(n));this.parent=t;(r=this.$dialog)===null||r===void 0?void 0:r.find("select.search-operator").on("change",n=>this.configureForOperator(n));(u=this.$dialog)===null||u===void 0?void 0:u.find("[button-type='calendar']").on("click",n=>this.selectDate(n));(f=this.$dialog)===null||f===void 0?void 0:f.find("[button-type='clock']").on("click",n=>this.selectTime(n));(e=this.$dialog)===null||e===void 0?void 0:e.find("[button-type='lookup']").on("click",n=>this.lookup(n));(o=this.$dialog)===null||o===void 0?void 0:o.find("input").get().forEach(n=>{const t=$(n);t.width(240);t.on("keyup",n=>this.criteriaEntered(n.target))});(s=this.$dialog)===null||s===void 0?void 0:s.find("input[datatype='DateTime'").get().forEach(n=>{const t=$(n);this.addDatePicker(t,this.parent.datePickerOptions)});(h=this.$dialog)===null||h===void 0?void 0:h.find("input[datatype='TimeSpan'").get().forEach(n=>{const t=$(n);this.addTimePicker(t)});(c=this.$dialog)===null||c===void 0?void 0:c.find("[button-type='clear']").on("click",()=>this.clear());(l=this.$dialog)===null||l===void 0?void 0:l.find("[button-type='apply']").on("click",()=>this.apply());(a=this.$dialog)===null||a===void 0?void 0:a.find("[button-type='cancel']").on("click",()=>this.close())}dialogOpened(){var n,t;const i=((n=this.$dialog)===null||n===void 0?void 0:n.find("table").first().width())+20;(t=this.$dialog)===null||t===void 0?void 0:t.dialog("option","width",i)}configureForOperator(n){const i=$(n.target),t=i.closest("tr");switch(i.val()){case"Between":case"NotBetween":t.find(".between").show();t.find("input").show().width(102);break;case"IsNull":case"IsNotNull":t.find(".between").hide();t.find("input").hide();break;default:t.find(".between").hide();t.find("input").show().width(240)}}criteriaEntered(n){const t=$(n);t.removeClass("highlight");const r=t.closest("tr").parent().closest("tr"),i=r.find("select");t.val()==""?i.val(""):i.val()==""&&i.prop("selectedIndex",1)}selectDate(n){const t=$(n.target);t.parent().find("input").datepicker("show")}lookup(n){const i=$(n.target),r=i.parent().find("input");let t;if(this.parent instanceof DbNetGrid)t=this.parent.getRequest();else if(this.parent instanceof DbNetEdit)t=this.parent.getRequest();else return;this.parent.lookup(r,t)}selectTime(n){const t=$(n.target);t.parent().find("input").timepicker("open");n.stopPropagation()}clear(){var n,t;(n=this.$dialog)===null||n===void 0?void 0:n.find(".content").find("input").get().forEach(n=>{const t=$(n);t.val("");t.removeClass("highlight")});(t=this.$dialog)===null||t===void 0?void 0:t.find(".content").find("select").get().forEach(n=>{const t=$(n);t.val("")})}apply(){var n,t,i;if(this.parent.searchParams=[],(n=this.$dialog)===null||n===void 0?void 0:n.find(".content").find("select").get().forEach(n=>{const t=$(n),i=t.closest("tr"),r=i.find("input:eq(0)"),u=i.find("input:eq(1)");if(t.val()!=""){const n={searchOperator:t.val(),columnIndex:r.attr("columnIndex"),value1:r.val(),value2:u.val()};this.parent.searchParams.push(n)}}),this.parent instanceof DbNetGrid){const n=this.parent;n.clearColumnFilters();n.searchFilterJoin=(t=this.$dialog)===null||t===void 0?void 0:t.find("#searchFilterJoin").val();n.currentPage=1;n.getPage(n=>this.getPageCallback(n))}else{const n=this.parent;n.searchFilterJoin=(i=this.$dialog)===null||i===void 0?void 0:i.find("#searchFilterJoin").val();n.currentRow=1;n.getRows(n=>this.getPageCallback(n))}}getPageCallback(n){n.searchParams&&(n.searchParams.forEach(n=>{var i;const t=(i=this.$dialog)===null||i===void 0?void 0:i.find(`tr[columnIndex='${n.columnIndex}']`),r=t===null||t===void 0?void 0:t.find("input:nth-of-type(1)"),u=t===null||t===void 0?void 0:t.find("input:nth-of-type(2)");n.value1Valid==!1&&(r===null||r===void 0?void 0:r.addClass("highlight"));n.value2Valid==!1&&(u===null||u===void 0?void 0:u.addClass("highlight"))}),n.message&&this.message(n.message))}}