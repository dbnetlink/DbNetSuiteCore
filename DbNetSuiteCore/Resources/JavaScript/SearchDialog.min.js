"use strict";class SearchDialog extends Dialog{constructor(n,t){var i,r,u,f,e,o,s,h,c,l,a;super(n);(i=this.$dialog)===null||i===void 0?void 0:i.on("dialogopen",n=>this.dialogOpened(n));this.parent=t;(r=this.$dialog)===null||r===void 0?void 0:r.find("select.search-operator").on("change",n=>this.configureForOperator(n));(u=this.$dialog)===null||u===void 0?void 0:u.find("[button-type='calendar']").on("click",n=>this.selectDate(n));(f=this.$dialog)===null||f===void 0?void 0:f.find("[button-type='clock']").on("click",n=>this.selectTime(n));(e=this.$dialog)===null||e===void 0?void 0:e.find("[button-type='lookup']").on("click",n=>this.lookup(n));(o=this.$dialog)===null||o===void 0?void 0:o.find("input").get().forEach(n=>{const t=$(n);t.width(240);t.on("keyup",n=>this.criteriaEntered(n.target))});(s=this.$dialog)===null||s===void 0?void 0:s.find("input[datatype='DateTime'").get().forEach(n=>{const t=$(n);this.addDatePicker(t)});(h=this.$dialog)===null||h===void 0?void 0:h.find("input[datatype='TimeSpan'").get().forEach(n=>{const t=$(n);this.addTimePicker(t)});(c=this.$dialog)===null||c===void 0?void 0:c.find("[button-type='clear']").on("click",()=>this.clear());(l=this.$dialog)===null||l===void 0?void 0:l.find("[button-type='apply']").on("click",()=>this.apply());(a=this.$dialog)===null||a===void 0?void 0:a.find("[button-type='cancel']").on("click",()=>this.close())}dialogOpened(){var n,t;const i=(n=this.$dialog)===null||n===void 0?void 0:n.find("table").first().height();i>400&&((t=this.$dialog)===null||t===void 0?void 0:t.find("div.content").height(400))}configureForOperator(n){const i=$(n.target),t=i.closest("tr");switch(i.val()){case"Between":case"NotBetween":t.find(".between").show();t.find("input").show().width(102);break;case"IsNull":case"IsNotNull":t.find(".between").hide();t.find("input").hide();break;default:t.find(".between").hide();t.find("input").show().width(240)}}pickerSelected(){const t=$(this).closest("tr").parent().closest("tr"),n=t.find("select");n.val()==""&&n.prop("selectedIndex",1)}criteriaEntered(n){const t=$(n);t.removeClass("highlight");const r=t.closest("tr").parent().closest("tr"),i=r.find("select");t.val()==""?i.val(""):i.val()==""&&i.prop("selectedIndex",1)}selectDate(n){const t=$(n.target);t.parent().find("input").datepicker("show")}lookup(n){const t=$(n.target),i=t.parent().find("input");this.parent.lookup(i)}selectTime(n){const t=$(n.target);t.parent().find("input").timepicker("open");n.stopPropagation()}clear(){var n,t;(n=this.$dialog)===null||n===void 0?void 0:n.find(".content").find("input").get().forEach(n=>{const t=$(n);t.val("");t.removeClass("highlight")});(t=this.$dialog)===null||t===void 0?void 0:t.find(".content").find("select").get().forEach(n=>{const t=$(n);t.val("")})}apply(){var n,t;this.parent.searchParams=[];(n=this.$dialog)===null||n===void 0?void 0:n.find(".content").find("select").get().forEach(n=>{const t=$(n),i=t.closest("tr"),r=i.find("input:eq(0)"),u=i.find("input:eq(1)");if(t.val()!=""){const n={searchOperator:t.val(),columnIndex:r.attr("columnIndex"),value1:r.val(),value2:u.val()};this.parent.searchParams.push(n)}});this.parent.clearColumnFilters();this.parent.searchFilterJoin=(t=this.$dialog)===null||t===void 0?void 0:t.find("#searchFilterJoin").val();this.parent.currentPage=1;this.parent.getPage(n=>this.getPageCallback(n))}getPageCallback(n){n.searchParams&&(n.searchParams.forEach(n=>{var i;const t=(i=this.$dialog)===null||i===void 0?void 0:i.find(`tr[columnIndex='${n.columnIndex}']`),r=t===null||t===void 0?void 0:t.find("input:nth-of-type(1)"),u=t===null||t===void 0?void 0:t.find("input:nth-of-type(2)");n.value1Valid==!1&&(r===null||r===void 0?void 0:r.addClass("highlight"));n.value2Valid==!1&&(u===null||u===void 0?void 0:u.addClass("highlight"))}),n.message&&this.message(n.message))}addDatePicker(n){const i=this.parent.datePickerOptions,u={D:"DD, MM dd, yy",DDDD:"DD",DDD:"D",MMMM:"MM",MMM:"M",M:"m",MM:"mm",yyyy:"yy"};let t=n.attr("format"),r;for(r in u){const n=new RegExp(`\\b${r}\\b`);t=t.replace(n,u[r])}t!=undefined&&t!=n.attr("format")&&(i.dateFormat=t);i.onSelect=this.pickerSelected;n.datepicker(i)}addTimePicker(n){const t={zindex:1e5};t.change=this.pickerSelected;n.timepicker(t)}}