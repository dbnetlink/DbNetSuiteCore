"use strict";class DbNetSuite{constructor(n){if((this.datePickerOptions={},this.element=undefined,this.eventHandlers={},this.internalEventHandlers={},this.id="",this.connectionString="",this.culture="",this.linkedControls=[],this.parentControlType="",this.parentChildRelationship=null,this.initialised=!1,this.parentControl=null,this.dataProvider=null,this.quickSearch=!1,this.quickSearchDelay=1e3,this.quickSearchMinChars=3,this.quickSearchToken="",n!=null)&&(this.id=n,this.element=$(`#${this.id}`),this.element.addClass("dbnetsuite").addClass("cleanslate").addClass("empty"),this.checkStyleSheetLoaded(),this.element.length==0)){this.error(`${this.constructor.name} container element '${this.id}' not found`);return}}bind(n,t){this.eventHandlers[n]||(this.eventHandlers[n]=[]);this.eventHandlers[n].push(t)}internalBind(n,t){this.internalEventHandlers[n]||(this.internalEventHandlers[n]=[]);this.internalEventHandlers[n].push({sender:this,method:t})}unbind(n,t){this.eventHandlers[n]!=null&&this.eventHandlers[n].forEach(n=>{n==t&&(n=function(){return})})}checkStyleSheetLoaded(){var n;let t=!1;for(const i of document.styleSheets)i.href&&((n=i===null||i===void 0?void 0:i.href)===null||n===void 0?void 0:n.indexOf("resource.dbnetsuite?action=css"))>0&&(t=!0);t||(alert("DbNetSuite stylesheet not found. Add @DbNetSuiteCore.StyleSheet() to your Razor page. See console for details."),console.error("DbNetSuite stylesheet not found. See https://dbnetsuitecore.z35.web.core.windows.net/index.htm?context=20#DbNetSuiteCoreStyleSheet"))}addLinkedControl(n){this.linkedControls.push(n);n.parentControl=this}fireEvent(n,t=undefined){if(this.eventHandlers[n]){const i=this.eventHandlers[n];i.forEach(n=>{let i=[this];t&&(i=i.concat([t]));n.apply(window,i)})}if(this.internalEventHandlers[n]){const i=this.internalEventHandlers[n];i.forEach(n=>{let i=[this];t&&(i=i.concat([t]));n.method.apply(n.context,i)})}}addPanel(n,t=undefined){const i=`${this.id}_${n}Panel`;return t==null&&(t=this.element),jQuery("<div>",{id:i}).addClass(`${this.constructor.name.toLowerCase()}-${n}`).appendTo(t),$(`#${i}`)}addLoadingPanel(){this.loadingPanel=this.addPanel("loading");this.addPanel("loadingIcon",this.loadingPanel);this.loadingPanel.addClass("dbnetsuite-loading");this.loadingPanel.children().first().addClass("icon")}showLoader(){var n,t;(n=this.loadingPanel)===null||n===void 0?void 0:n.addClass("display");(t=this.element)===null||t===void 0?void 0:t.css("pointer-events","none")}hideLoader(){var n,t,i;(n=this.element)===null||n===void 0?void 0:n.removeClass("empty");(t=this.loadingPanel)===null||t===void 0?void 0:t.removeClass("display");(i=this.element)===null||i===void 0?void 0:i.css("pointer-events","all")}post(n,t,i=false,r=null){this.showLoader();let u={};return u=t instanceof FormData?{method:"POST",body:t}:{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(t)},r==null&&(r=this.constructor.name.toLowerCase()),fetch(`~/${r}.dbnetsuite?action=${n}`,u).then(n=>{if(this.hideLoader(),!n.ok)throw n;return i?n.blob():n.json()}).catch(n=>(n.text().then(n=>{console.error(n),this.error(n.split("\n").shift())}),Promise.reject()))}controlElement(n){return $(`#${this.controlElementId(n)}`)}controlElementId(n){return`${this.id}_${n}`}disable(n,t){this.controlElement(n).prop("disabled",t)}setInputElement(n,t){const i=this.controlElement(n);i.val(t.toString());i.width(`${t.toString().length*8+8}px`)}configureLinkedControls(n,t=null,i=null){this.linkedControls.forEach(r=>{this._configureLinkedControl(r,n,t,i)})}linkedGridOrEdit(){let n=!1;return this.linkedControls.forEach(t=>{(t instanceof DbNetGrid||t instanceof DbNetEdit)&&(n=!0)}),n}parentGridOrEdit(){return this.parentControl instanceof DbNetGrid||this.parentControl instanceof DbNetEdit}configureParentDeleteButton(n){var t;(t=this.parentControl)===null||t===void 0?void 0:t.disable("DeleteBtn",n)}info(n,t){this.showMessageBox(MessageBoxType.Info,n,t)}confirm(n,t,i){this.showMessageBox(MessageBoxType.Confirm,n,t,i)}error(n,t=null){this.showMessageBox(MessageBoxType.Error,n,t)}showMessageBox(n,t,i=null,r=undefined){var u;this.messageBox==undefined&&this.post("message-box",this._getRequest(),!1,"dbnetsuite").then(u=>{var f,e;(f=this.element)===null||f===void 0?void 0:f.append(u.html);this.messageBox=new MessageBox(`${this.id}_message_box`);(e=this.messageBox)===null||e===void 0?void 0:e.show(n,t,i,r)});(u=this.messageBox)===null||u===void 0?void 0:u.show(n,t,i,r)}addDatePicker(n,t){const r=t,u={D:"DD, MM dd, yy",DDDD:"DD",DDD:"D",MMMM:"MM",MMM:"M",M:"m",MM:"mm",yyyy:"yy"};let i=n.attr("format");if(i!=undefined){let t;for(t in u){const n=new RegExp(`\\b${t}\\b`);i=i.replace(n,u[t])}i!=n.attr("format")&&(r.dateFormat=i)}r.onSelect=this.pickerSelected;n.datepicker(r)}pickerSelected(){const t=$(this).closest("tr").parent().closest("tr"),n=t.find("select");n.val()==""&&n.prop("selectedIndex",1)}_configureLinkedControl(n,t,i,r){this instanceof DbNetGrid&&this.configureLinkedControl(n,t,i,r);this instanceof DbNetCombo&&this.configureLinkedControl(n,t,i);this instanceof DbNetEdit&&this.configureLinkedControl(n,i);this instanceof DbNetFile&&this.configureLinkedControl(n,t)}_getRequest(){return{componentId:this.id,connectionString:this.connectionString,culture:this.culture,parentControlType:this.parentControlType,dataProvider:this.dataProvider}}highlight(){var n;const t="highlight-dbnetsuite-container";(n=this.element)===null||n===void 0?void 0:n.addClass(t);window.setTimeout(()=>{var n;(n=this.element)===null||n===void 0?void 0:n.removeClass(t)},3e3)}viewImage(n){const t=$(n.currentTarget);this.openImageViewer(t.attr("src"),t.data("filename"))}viewUrl(n,t,i="Image"){this.openImageViewer(n,t,i)}openImageViewer(n,t,i="Image"){if(this.imageViewer){this.imageViewer.show(n,t,i);return}this.post("image-viewer",this._getRequest(),!1,"dbnetsuite").then(r=>{var u;this.imageViewer||((u=this.element)===null||u===void 0?void 0:u.append(r.html),this.imageViewer=new ImageViewer(`${this.id}_image_viewer`),this.imageViewer.show(n,t,i))})}quickSearchKeyPress(n){const t=n.target;window.clearTimeout(this.quickSearchTimerId);(t.value.length>=this.quickSearchMinChars||t.value.length==0||n.key=="Enter")&&(this.quickSearchTimerId=window.setTimeout(()=>{this.runQuickSearch(t.value)},this.quickSearchDelay))}runQuickSearch(n){if(this.quickSearchToken=n,this instanceof DbNetGrid){const n=this;n.reload()}else if(this instanceof DbNetEdit){const n=this;n.currentRow=1;n.getRows()}else if(this instanceof DbNetFile){const n=this;n.reload()}}copyTableToClipboard(n){var t,i;try{const r=document.createRange();r.selectNode(n);(t=window.getSelection())===null||t===void 0?void 0:t.addRange(r);document.execCommand("copy");(i=window.getSelection())===null||i===void 0?void 0:i.removeRange(r)}catch(r){try{const t=n.innerHTML,i=new Blob([t],{type:"text/html"}),r=new ClipboardItem({"text/html":i});navigator.clipboard.write([r])}catch(r){this.error("Copy failed");return}}}}DbNetSuite.DBNull="DBNull";document.addEventListener("DOMContentLoaded",function(){$.fn.button&&$.fn.button.noConflict!==undefined&&($.fn.bootstrapBtn=$.fn.button.noConflict())});