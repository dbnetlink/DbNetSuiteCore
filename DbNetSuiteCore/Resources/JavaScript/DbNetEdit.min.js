"use strict";class DbNetEdit extends DbNetGridEdit{constructor(n){super(n);this.changes={};this.currentRow=1;this.search=!0;this.totalRows=0;this.primaryKey="";this.columns=[]}initialize(){this.element&&(this.element.empty(),this.toolbarPosition=="Top"&&(this.toolbarPanel=this.addPanel("toolbar")),this.formPanel=this.addPanel("form"),this.toolbarPosition=="Bottom"&&(this.toolbarPanel=this.addPanel("toolbar")),this.addLoadingPanel(),this.callServer("initialize"),this.initialised=!0,this.fireEvent("onInitialized"))}addLinkedControl(n){this.linkedControls.push(n)}reload(){this.callServer("page")}configureEdit(n){var t,i;this.toolbarPanel&&(n.toolbar&&((t=this.toolbarPanel)===null||t===void 0?void 0:t.html(n.toolbar)),this.configureToolbar(n));n.form&&((i=this.formPanel)===null||i===void 0?void 0:i.html(n.form));this.updateForm(n)}updateForm(n){var t;const i=n.record;for(const n in i){const u=(t=this.formPanel)===null||t===void 0?void 0:t.find(`input[name='${n}']`),r=i[n].toString();u.val(r).data("value",r)}this.primaryKey=n.primaryKey;n.message&&this.message(n.message)}callServer(n){this.post(n,this.getRequest()).then(n=>{n.error==!1&&(this.updateColumns(n),this.configureEdit(n))})}getRequest(){return{componentId:this.id,connectionString:this.connectionString,fromPart:this.fromPart,columns:this.columns.map(n=>n),currentRow:this.currentRow,culture:this.culture,search:this.search,navigation:this.navigation,quickSearch:this.quickSearch,totalRows:this.totalRows,primaryKey:this.primaryKey,changes:this.changes}}configureToolbar(n){if(n.toolbar)["First","Next","Previous","Last","Cancel","Apply","Search"].forEach(n=>this.addEventListener(`${n}Btn`));const t=this.controlElement("dbnetedit-toolbar").find(".navigation"),i=this.controlElement("no-records-cell");this.setInputElement("Rows",n.totalRows);n.totalRows==0?(t.hide(),i.show()):(t.show(),i.hide(),this.controlElement("dbnetgrid-toolbar").find(".navigation").show(),this.setInputElement("RowNumber",n.currentRow),this.setInputElement("RowCount",n.totalRows),this.currentRow=n.currentRow,this.totalRows=n.totalRows,this.disable("FirstBtn",n.currentRow==1),this.disable("PreviousBtn",n.currentRow==1),this.disable("NextBtn",n.currentRow==n.totalRows),this.disable("LastBtn",n.currentRow==n.totalRows));this.controlElement("QuickSearch").on("keyup",n=>this.quickSearchKeyPress(n))}updateColumns(n){var t;this.columns=[];(t=n.columns)===null||t===void 0?void 0:t.forEach(n=>{const t={columnExpression:n.columnExpression,columnName:n.columnName,label:n.label,format:n.format,foreignKey:n.foreignKey};this.columns.push(new EditColumn(t))})}addEventListener(n,t="click"){this.controlElement(n).on(t,n=>this.handleClick(n))}handleClick(n){const t=n.target.id;switch(t){case this.controlElementId("FirstBtn"):this.currentRow=1;break;case this.controlElementId("NextBtn"):this.currentRow++;break;case this.controlElementId("PreviousBtn"):this.currentRow--;break;case this.controlElementId("LastBtn"):this.currentRow=this.totalRows;break;case this.controlElementId("SearchBtn"):case this.controlElementId("CancelBtn"):case this.controlElementId("ApplyBtn"):break;default:return}n.preventDefault();switch(t){case this.controlElementId("SearchBtn"):this.openSearchDialog();break;case this.controlElementId("ApplyBtn"):this.applyChanges();break;default:this.getRecord()}}openSearchDialog(){if(this.searchDialog){this.searchDialog.open();return}this.post("search-dialog",this.getRequest()).then(n=>{var t;(t=this.element)===null||t===void 0?void 0:t.append(n.data);this.searchDialog=new SearchDialog(`${this.id}_search_dialog`,this);this.searchDialog.open()})}quickSearchKeyPress(n){const t=n.target;window.clearTimeout(this.quickSearchTimerId);(t.value.length>=this.quickSearchMinChars||t.value.length==0||n.key=="Enter")&&(this.quickSearchTimerId=window.setTimeout(()=>{this.runQuickSearch(t.value)},this.quickSearchDelay))}runQuickSearch(n){this.quickSearchToken=n;this.currentRow=1;this.runSearch()}runSearch(){return}getRecord(){this.callServer("getrecord")}applyChanges(){var n;const t={};((n=this.formPanel)===null||n===void 0?void 0:n.find(":input.dbnetedit").each(function(){const n=$(this);n.val()!=n.data("value")&&(t[n.attr("name")]=n.val())}),$.isEmptyObject(t))||(this.changes=t,this.callServer("applychanges"))}message(n){var t;(t=this.formPanel)===null||t===void 0?void 0:t.find(".message").html(n).addClass("highlight");setInterval(()=>this.clearMessage(),5e3)}clearMessage(){var n;(n=this.formPanel)===null||n===void 0?void 0:n.find(".message").html("&nbsp;").removeClass("highlight")}}