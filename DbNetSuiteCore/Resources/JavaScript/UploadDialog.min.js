"use strict";class UploadDialog extends Dialog{constructor(n,t){var i,r,u,f,e,o;super(n);(i=this.$dialog)===null||i===void 0?void 0:i.on("dialogopen",n=>this.dialogOpened(n));this.parent=t;this.inputFile=((r=this.$dialog)===null||r===void 0?void 0:r.find("input[type='file']"))[0];(u=this.$dialog)===null||u===void 0?void 0:u.find("[button-type='uploadfile']").on("click",()=>this.selectFile());$(this.inputFile).on("change",()=>this.fileSelected());this.$apply=(f=this.$dialog)===null||f===void 0?void 0:f.find("[button-type='apply']");this.$apply.on("click",()=>this.apply());(e=this.$dialog)===null||e===void 0?void 0:e.find("[button-type='cancel']").on("click",()=>this.close());this.$previewImage=(o=this.$dialog)===null||o===void 0?void 0:o.find("img.preview");this.$previewImage.on("load",()=>this.previewLoaded())}dialogOpened(){var n,t;this.clear();const i=((n=this.$dialog)===null||n===void 0?void 0:n.find("table.file-info").height())+10;(t=this.$dialog)===null||t===void 0?void 0:t.find("img.preview").height(i);this.sizeDialog()}sizeDialog(){var n,t;const i=((n=this.$dialog)===null||n===void 0?void 0:n.find("table").first().width())+20;(t=this.$dialog)===null||t===void 0?void 0:t.dialog("option","width",i)}show(n){this.$uploadButton=$(n.currentTarget);this.$editImage=this.$uploadButton.closest("td").find("img");$(this.inputFile).attr("accept",this.$editImage.attr("accept"));this.open()}previewLoaded(){this.$previewImage.show();this.sizeDialog()}selectFile(){$(this.inputFile).trigger("click")}fileSelected(){var n,t,i,r,u;const f=this.$previewImage[0];this.file=(n=this.inputFile.files)===null||n===void 0?void 0:n.item(0);this.fileMetaData={fileName:this.file.name,size:this.file.size,contentType:this.file.type,lastModified:new Date(this.file.lastModified)};(t=this.$dialog)===null||t===void 0?void 0:t.find("#name").val(this.file.name);(i=this.$dialog)===null||i===void 0?void 0:i.find("#lastmodified").val(new Date(this.file.lastModified).toLocaleString());(r=this.$dialog)===null||r===void 0?void 0:r.find("#type").val(this.file.type);(u=this.$dialog)===null||u===void 0?void 0:u.find("#size").val(this.file.size);this.file.type.startsWith("image/")?this.renderFileAsImage(f):this.renderFileAsNonImage(f);this.$apply.prop("disabled",!1);this.sizeDialog()}clear(){var n;(n=this.$dialog)===null||n===void 0?void 0:n.find("input").val("");this.$previewImage.hide();this.$apply.prop("disabled",!0)}renderFileAsImage(n){const t=new FileReader;t.onload=function(){n.src=t.result};t.readAsDataURL(this.file)}renderFileAsNonImage(n){var t;$(n).hide();$(n).parent().addClass("file");const i=this.file.name,r=(t=i.split(".").pop())===null||t===void 0?void 0:t.toLowerCase();switch(r){case"csv":$(n).parent().addClass(r);break;default:$(n).parent().addClass("default")}$(n).parent().attr("title",i)}apply(){const n=this.$editImage;this.file.type.startsWith("image/")&&this.renderFileAsImage(n.get(0));const t=new File([this.file],this.file.name);this.parent.saveFile(n,t,this.fileMetaData);this.close()}}