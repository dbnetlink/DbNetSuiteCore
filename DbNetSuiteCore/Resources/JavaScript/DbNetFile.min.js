"use strict";class DbNetFile extends DbNetSuite{constructor(n){super(n);this.rootFolder="";this.folder="";this.quickSearch=!0;this.quickSearchToken="";this.toolbarButtonStyle=ToolbarButtonStyle.Image;this.search=!0;this.export=!0;this.copy=!0;this.upload=!1;this.navigation=!0;this.totalRows=0;this.totalPages=0;this.currentPage=1;this.pageSize=20;this.caption="";this.nested=!1;this.columns=[]}initialize(){this.element&&(this.rootFolder=this.folder,this.element.empty(),this.toolbarPanel=this.addPanel("toolbar"),this.folderPanel=this.addPanel("folder"),this.addLoadingPanel(),this.callServer("initialise"),this.initialised=!0,this.fireEvent("onInitialized"))}setColumnTypes(...n){n.forEach(n=>{this.columns.push(new FileColumn(n))})}reload(){this.callServer("page")}configureToolbar(n){if(n.toolbar)["First","Next","Previous","Last","Export","Copy","Search","Upload"].forEach(n=>this.addEventListener(`${n}Btn`));const t=this.controlElement("dbnetfile-toolbar").find(".navigation"),i=this.controlElement("no-records-cell");this.setInputElement("Rows",n.totalRows);this.totalRows=n.totalRows;n.totalRows==0?(t.hide(),i.show(),this.configureLinkedControls(null)):(t.show(),i.hide(),this.controlElement("dbnetfile-toolbar").find(".navigation").show(),this.setInputElement("PageNumber",n.currentPage),this.setInputElement("PageCount",n.totalPages),this.currentPage=n.currentPage,this.totalPages=n.totalPages,this.disable("FirstBtn",n.currentPage==1),this.disable("PreviousBtn",n.currentPage==1),this.disable("NextBtn",n.currentPage==n.totalPages),this.disable("LastBtn",n.currentPage==n.totalPages));this.controlElement("QuickSearch").on("keyup",n=>this.quickSearchKeyPress(n));this.disable("ExportBtn",n.totalRows==0);this.disable("CopyBtn",n.totalRows==0);this.disable("UpdateBtn",n.totalRows==0)}configurePage(n){var t,i,r,u;this.toolbarPanel&&(n.toolbar&&((t=this.toolbarPanel)===null||t===void 0?void 0:t.html(n.toolbar)),this.configureToolbar(n));(i=this.folderPanel)===null||i===void 0?void 0:i.html(n.html);(r=this.folderPanel)===null||r===void 0?void 0:r.find("a.folder-link").get().forEach(n=>{$(n).on("click",n=>this.selectFolder(n))});(u=this.folderPanel)===null||u===void 0?void 0:u.find("td.folder").get().forEach(n=>{$(n).on("click",n=>this.openNestedFolder(n))});this.fireEvent("onPageLoaded",{})}selectFolder(n){const t=$(n.currentTarget);this.folder=t.data("folder");this.callServer("page")}openNestedFolder(n){const t=$(n.currentTarget),i=t.closest("tr");if(t.hasClass("open")){t.removeClass("open");i.next().hide();return}const o=t.closest("table");if(t.addClass("open"),i.next().hasClass("nested-folder-row")){i.next().show();return}const r=o[0].insertRow(i[0].rowIndex+1);r.className="nested-folder-row";r.insertCell(-1);const u=r.insertCell(-1);u.className="nested-folder-cell";u.colSpan=i[0].cells.length-1;const e=`dbnetfile${(new Date).valueOf()}`;jQuery(document.createElement("div")).attr("id",e).appendTo($(u));const f=new DbNetFile(e);f.folder=t.data("folder");f.nested=!0;f.initialize()}callServer(n){this.post(n,this.getRequest()).then(n=>{n.error==!1&&this.configurePage(n)})}addEventListener(n,t="click"){this.controlElement(n).on(t,n=>this.handleClick(n))}handleClick(n){const t=n.target.id;switch(t){case this.controlElementId("FirstBtn"):this.currentPage=1;break;case this.controlElementId("NextBtn"):this.currentPage++;break;case this.controlElementId("PreviousBtn"):this.currentPage--;break;case this.controlElementId("LastBtn"):this.currentPage=this.totalPages}n.preventDefault();switch(t){case this.controlElementId("ExportBtn"):break;case this.controlElementId("CopyBtn"):break;case this.controlElementId("SearchBtn"):break;case this.controlElementId("UploadBtn"):break;default:this.reload()}}getRequest(){const n=this._getRequest();return n.rootFolder=this.rootFolder,n.folder=this.folder,n.columns=this.columns.map(n=>n),n.quickSearch=this.quickSearch,n.quickSearchToken=this.quickSearchToken,n.toolbarButtonStyle=this.toolbarButtonStyle,n.search=this.search,n.export=this.export,n.copy=this.copy,n.upload=this.upload,n.navigation=this.navigation,n.pageSize=this.pageSize,n.currentPage=this.currentPage,n.caption=this.caption,n}}